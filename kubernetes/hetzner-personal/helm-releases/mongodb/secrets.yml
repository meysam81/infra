apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: mongodb-secrets
spec:
  refreshInterval: 5m
  dataFrom:
    - sourceRef:
        generatorRef:
          apiVersion: generators.external-secrets.io/v1alpha1
          kind: Password
          name: mongo-password
      rewrite:
        - regexp:
            source: password
            target: appPassword
    # - sourceRef:
    #     generatorRef:
    #       apiVersion: generators.external-secrets.io/v1alpha1
    #       kind: Password
    #       name: root-password
    #   rewrite:
    #     #   - regexp:
    #     #       source: password
    #     #       target: rootPassword
    #     - transform:
    #         template: |
    #           rootPassword: "{{ .password | toString -}}"

  target:
    immutable: false
    template:
      data:
        values.yaml: |
          auth:
            rootPassword: "{{ .rootPassword | toString -}}"
            passwords:
              - "{{ .appPassword | toString -}}"
