apiVersion: operator.victoriametrics.com/v1beta1
kind: VMServiceScrape
metadata:
  name: oathkeeper-maester
  labels:
    app.kubernetes.io/instance: oathkeeper-maester
    app.kubernetes.io/component: oathkeeper-maester-metrics
spec:
  endpoints:
    - interval: 60s
      path: /metric
      port: metrics
      scheme: http
      scrapeTimeout: 30s
      relabelConfigs:
        - action: keep
          source_labels: [__meta_kubernetes_service_label_app_kubernetes_io_component]
        - action: keep
          source_labels: [__meta_kubernetes_service_label_app_kubernetes_io_instance]
        - action: keep
          source_labels: [__meta_kubernetes_service_label_app_kubernetes_io_managed_by]
          regex: Kustomize
        - action: keep
          source_labels: [__meta_kubernetes_service_label_app_kubernetes_io_name]
          regex: oathkeeper
        - action: keep
          source_labels: [__meta_kubernetes_service_label_app_kubernetes_io_part_of]
          regex: auth
        - action: keep
          source_labels: [__meta_kubernetes_service_label_app_kubernetes_io_version]
          regex: 0.40.7
        - action: keep
          source_labels: [__meta_kubernetes_endpoint_port_name]
          regex: http
        - source_labels: [__meta_kubernetes_endpoint_address_target_kind, __meta_kubernetes_endpoint_address_target_name]
          separator: ;
          target_label: node
          regex: Node;(.*)
          replacement: ${1}
        - source_labels: [__meta_kubernetes_endpoint_address_target_kind, __meta_kubernetes_endpoint_address_target_name]
          separator: ;
          target_label: pod
          regex: Pod;(.*)
          replacement: ${1}
        - source_labels: [__meta_kubernetes_pod_name]
          target_label: pod
        - source_labels: [__meta_kubernetes_pod_container_name]
          target_label: container
        - source_labels: [__meta_kubernetes_namespace]
          target_label: namespace
        - source_labels: [__meta_kubernetes_service_name]
          target_label: service
        - source_labels: [__meta_kubernetes_service_name]
          target_label: job
          replacement: ${1}
        - target_label: endpoint
          replacement: http
