- become: true
  gather_facts: true
  hosts: hetzner
  name: Configure monitoring
  roles:
    - monitoring
  tags:
    - monitoring
  vars_files:
    - ./vars.yml
- become: true
  environment:
    KUBECONFIG: /home/meysam/.kube/config
  gather_facts: true
  hosts: hetzner
  name: Configure K8s networking
  roles:
    - cilium
  tags:
    - network
- become: true
  environment:
    KUBECONFIG: /home/meysam/.kube/config
  gather_facts: true
  hosts: hetzner
  name: Configure K8s gitops
  roles:
    - fluxcd
  tags:
    - fluxcd
  vars_files:
    - ./vars.yml
- become: true
  gather_facts: true
  hosts: hetzner
  name: Configure K8s OIDC
  roles:
    - k8s-oidc
  tags:
    - oidc
  vars:
    kubeconfig: /home/meysam/.kube/config
  vars_files:
    - ./vars.yml
- become: true
  environment:
    AWS_PROFILE: personal
    KUBECONFIG: /home/meysam/.kube/config
  gather_facts: false
  hosts: hetzner
  name: Configure cluster secret store
  vars_files:
    - ./vars.yml
  roles:
    - cluster-secret-store
  tags:
    - css
    - never
