apiVersion: operator.victoriametrics.com/v1beta1
kind: VMRule
metadata:
  name: check-public-ip
spec:
  groups:
    - name: check-public-ip-recording
      interval: 20s
      rules:
        - record: public_ip_total
          expr: count by (ip_address) (count_over_time(public_ip[10m]))
          debug: true
    - name: check-public-ip-alerting
      interval: 30s
      rules:
        - alert: IpChanged
          expr: public_ip_total > 1
          for: 0s
          labels:
            severity: warning
          annotations:
            summary: Public IP address changed
            description: >-
              The public IP address of instance {{ $labels.instance }} has
              changed, again!
