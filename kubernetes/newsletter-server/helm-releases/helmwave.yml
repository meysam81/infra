project: newsletter-server
version: 0.41.1

repositories:
  - url: https://charts.external-secrets.io
    name: external-secrets
  - url: https://victoriametrics.github.io/helm-charts/
    name: victoria-metrics
  - url: https://grafana.github.io/helm-charts
    name: grafana
  - url: https://aquasecurity.github.io/helm-charts/
    name: aquasecurity
  - url: https://charts.jetstack.io
    name: cert-manager

registries:
  - host: ghcr.io

.options: &options
  create_namespace: true
  wait: true
  timeout: 5m
  max_history: 10
  pending_release_strategy: rollback

releases:
  - name: external-secrets
    namespace: external-secrets
    chart:
      name: external-secrets/external-secrets
      version: 0.10.x
    values:
      - ./helm-values/external-secrets.yml
    tags:
      - external-secrets
    <<: *options
  - name: grafana-operator
    namespace: monitoring
    chart:
      name: oci://ghcr.io/grafana/helm-charts/grafana-operator
      version: v5.12.0
    <<: *options
  - name: victoria-metrics-k8s-stack
    namespace: monitoring
    chart:
      name: victoria-metrics/victoria-metrics-k8s-stack
      version: 0.25.x
    values:
      - src: ./helm-values/victoria-metrics-k8s-stack.yml
        renderer: copy
    depends_on:
      - grafana-operator
      - external-secrets@external-secrets
    tags:
      - victoria-metrics-k8s-stack
      - vm
    <<: *options
  - name: promtail
    namespace: monitoring
    chart:
      name: grafana/promtail
      version: 6.16.x
    values:
      - ./helm-values/promtail.yml
    depends_on:
      - victoria-metrics-k8s-stack
    <<: *options
  - name: trivy-operator
    namespace: kube-system
    chart:
      name: aquasecurity/trivy-operator
      version: 0.24.x
    values:
      - ./helm-values/trivy-operator.yml
    tags:
      - trivy-operator
    <<: *options
  - name: cert-manager
    namespace: cert-manager
    chart:
      name: cert-manager/cert-manager
      version: 1.15.x
    values:
      - ./helm-values/cert-manager.yml
    tags:
      - cert-manager
    <<: *options
