#!/usr/bin/env sh

# This script will run as root to prepare the files for the static web server

set -eu

mkdir -p {{ static_web_server_static }}/.well-known \
  {{ static_web_server_static }}/openid/v1

kubectl get --raw /.well-known/openid-configuration > \
  {{ static_web_server_static }}/.well-known/openid-configuration

kubectl get --raw /openid/v1/jwks > \
  {{ static_web_server_static }}/openid/v1/jwks

cp /etc/letsencrypt/live/{{ domain_name }}/fullchain.pem \
  {{ static_web_server_root }}/cert.pem

cp /etc/letsencrypt/live/{{ domain_name }}/privkey.pem \
  {{ static_web_server_root }}/key.pem


chown -R static-web-server:static-web-server {{ static_web_server_root }}
